{"version":3,"file":"Selection.test.js","sourceRoot":"../src/","sources":["selection/Selection.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { Selection } from './Selection';\nimport { SelectionMode } from './Selection.types';\nimport type { IObjectWithKey } from './Selection.types';\n\nconst setA = [{ key: 'a' }, { key: 'b' }, { key: 'c' }];\nconst setB = [{ key: 'a' }, { key: 'd' }, { key: 'b' }];\n\ndescribe('Selection', () => {\n  const onSelectionChanged = jest.fn();\n\n  afterEach(() => {\n    onSelectionChanged.mockClear();\n  });\n\n  it('initializes selected count', () => {\n    const selection = new Selection();\n    expect(selection.count).toBe(0);\n  });\n\n  it('can receive items', () => {\n    const selection = new Selection({ onSelectionChanged, items: setA });\n\n    expect(onSelectionChanged).toHaveBeenCalledTimes(0);\n\n    selection.setKeySelected('a', true, true);\n    selection.setKeySelected('a', true, true);\n    selection.setIndexSelected(0, true, true);\n    expect(onSelectionChanged).toHaveBeenCalledTimes(1);\n  });\n\n  it('fires change events only when selection changes occur', () => {\n    const selection = new Selection({ onSelectionChanged });\n\n    selection.setItems(setA, false);\n    expect(onSelectionChanged).toHaveBeenCalledTimes(0);\n\n    selection.setKeySelected('a', true, true);\n    selection.setKeySelected('a', true, true);\n    selection.setIndexSelected(0, true, true);\n    expect(onSelectionChanged).toHaveBeenCalledTimes(1);\n\n    // Switch to set b, which also contains item a, in the same position. No change event should occur.\n    selection.setItems(setB, false);\n    expect(onSelectionChanged).toHaveBeenCalledTimes(1);\n\n    // Select b\n    selection.setKeySelected('b', true, true);\n    expect(onSelectionChanged).toHaveBeenCalledTimes(2);\n\n    // Change back to set a, which has item b in a different index.\n    selection.setItems(setA, false);\n    expect(onSelectionChanged).toHaveBeenCalledTimes(3);\n\n    // Change to set b, but clear it.\n    selection.setItems(setB, true);\n    expect(onSelectionChanged).toHaveBeenCalledTimes(4);\n\n    // Select an item in set b that doesn't exist in set a, then switch to set a.\n    selection.setKeySelected('d', true, true);\n    selection.setItems(setA, false);\n    expect(onSelectionChanged).toHaveBeenCalledTimes(6);\n\n    // Select an item, clear, clear again.\n    selection.setAllSelected(true);\n    selection.setAllSelected(true);\n    selection.setAllSelected(false);\n    selection.setAllSelected(false);\n    expect(onSelectionChanged).toHaveBeenCalledTimes(8);\n\n    selection.setIndexSelected(0, true, true);\n    selection.selectToIndex(2, true);\n    expect(onSelectionChanged).toHaveBeenCalledTimes(10);\n  });\n\n  it('returns false on isAllSelected when no items are selectable', () => {\n    const selection = new Selection({\n      canSelectItem: () => false,\n      onSelectionChanged,\n      items: setA,\n    });\n\n    expect(selection.isAllSelected()).toEqual(false);\n\n    selection.setAllSelected(true);\n\n    expect(selection.isAllSelected()).toEqual(false);\n\n    expect(onSelectionChanged).toHaveBeenCalledTimes(0);\n  });\n\n  it('resets unselectable count on setting new items', () => {\n    let canSelect = false;\n    const selection = new Selection({\n      canSelectItem: () => canSelect,\n      items: setA,\n    });\n\n    expect(selection.isAllSelected()).toEqual(false);\n    selection.setAllSelected(true);\n    expect(selection.isAllSelected()).toEqual(false);\n\n    canSelect = true;\n    selection.setItems(setA);\n    selection.setAllSelected(true);\n    expect(selection.isAllSelected()).toEqual(true);\n  });\n\n  it('notifies consumers when all items are selected and some are removed', () => {\n    const selection = new Selection({\n      onSelectionChanged,\n      items: setA,\n    });\n\n    selection.setAllSelected(true);\n\n    expect(onSelectionChanged).toHaveBeenCalledTimes(1);\n    expect(selection.getSelectedCount()).toEqual(3);\n\n    selection.setItems([{ key: 'a' }, { key: 'b' }], false);\n\n    expect(onSelectionChanged).toHaveBeenCalledTimes(2);\n    expect(selection.getSelectedCount()).toEqual(2);\n\n    selection.setItems([], false);\n\n    expect(onSelectionChanged).toHaveBeenCalledTimes(3);\n    expect(selection.getSelectedCount()).toEqual(0);\n  });\n\n  it('notifies consumers when some items are selected and some are removed', () => {\n    const selection = new Selection({\n      onSelectionChanged,\n      items: setA,\n    });\n\n    selection.setIndexSelected(2, true, false);\n\n    expect(onSelectionChanged).toHaveBeenCalledTimes(1);\n    expect(selection.count).toEqual(1);\n\n    selection.setItems([{ key: 'a' }, { key: 'b' }], false);\n\n    expect(onSelectionChanged).toHaveBeenCalledTimes(2);\n    expect(selection.count).toEqual(0);\n  });\n\n  it('allows custom item type', () => {\n    interface ICustomItem {\n      id: string;\n    }\n    const items: ICustomItem[] = [{ id: 'a' }, { id: 'b' }];\n    const selection = new Selection<ICustomItem>({\n      onSelectionChanged: onSelectionChanged,\n      getKey: (item: ICustomItem) => item.id,\n      items,\n    });\n\n    selection.setKeySelected('a', true, true);\n    expect(onSelectionChanged).toHaveBeenCalledTimes(1);\n  });\n\n  it('respects 0 as selected key', () => {\n    const items: IObjectWithKey[] = [{ key: 1 }, { key: 0 }];\n    const selection = new Selection({ items, selectionMode: SelectionMode.multiple });\n\n    expect(selection.isKeySelected('0')).toBe(false);\n\n    selection.setKeySelected('0', true, false);\n    expect(selection.getSelectedIndices()).toEqual([1]);\n    expect(selection.getSelection()).toEqual([{ key: 0 }]);\n    expect(selection.isKeySelected('0')).toBe(true);\n    expect(selection.isIndexSelected(1)).toBe(true);\n\n    selection.toggleKeySelected('0');\n    expect(selection.isKeySelected('0')).toBe(false);\n    expect(selection.getSelection()).toEqual([]);\n\n    selection.setIndexSelected(0, false, true); // hack to reset anchor\n    selection.selectToKey('0');\n    expect(selection.getSelectedIndices()).toEqual([0, 1]);\n  });\n\n  it('allows selection to be pre-initialized', () => {\n    const items1: IObjectWithKey[] = [{ key: 'a' }, { key: 'b' }];\n\n    // Add a callback to make sure an item always shows as selected if present.\n    // The expectation is that the change to selection is merged with the existing update.\n    const onItemsChanged = jest.fn(() => {\n      selection.setKeySelected('b', true, false);\n    });\n\n    const selection = new Selection({\n      items: [] as IObjectWithKey[],\n      selectionMode: SelectionMode.multiple,\n      onItemsChanged,\n      onSelectionChanged,\n    });\n\n    expect(onSelectionChanged).toHaveBeenCalledTimes(0);\n    expect(onItemsChanged).toHaveBeenCalledTimes(0);\n\n    expect(selection.getSelection()).toEqual([]);\n\n    selection.setItems(items1);\n\n    expect(onItemsChanged).toHaveBeenCalledTimes(1);\n    expect(onSelectionChanged).toHaveBeenCalledTimes(1);\n\n    expect(selection.getSelection()).toEqual([{ key: 'b' }]);\n\n    selection.setKeySelected('a', true, false);\n\n    expect(onItemsChanged).toHaveBeenCalledTimes(1);\n    expect(onSelectionChanged).toHaveBeenCalledTimes(2);\n\n    expect(selection.getSelection()).toEqual([{ key: 'a' }, { key: 'b' }]);\n\n    const items2: IObjectWithKey[] = [{ key: 'c' }, { key: 'd' }];\n\n    // Change the set of items such that the 'selected' item is no longer present.\n    selection.setItems(items2);\n\n    expect(onItemsChanged).toHaveBeenCalledTimes(2);\n    expect(onSelectionChanged).toHaveBeenCalledTimes(3);\n\n    expect(selection.getSelection()).toEqual([]);\n\n    selection.setItems(items1);\n\n    expect(onItemsChanged).toHaveBeenCalledTimes(3);\n    expect(onSelectionChanged).toHaveBeenCalledTimes(4);\n\n    expect(selection.getSelection()).toEqual([{ key: 'b' }]);\n\n    // Set an item as selected, then flip their order, within the same change event.\n    selection.setChangeEvents(false);\n    selection.setKeySelected('a', true, false);\n    selection.setItems([{ key: 'b' }, { key: 'a' }], false);\n    selection.setChangeEvents(true);\n\n    expect(onItemsChanged).toHaveBeenCalledTimes(4);\n    expect(onSelectionChanged).toHaveBeenCalledTimes(5);\n\n    expect(selection.getSelection()).toEqual([{ key: 'b' }, { key: 'a' }]);\n  });\n});\n"]}