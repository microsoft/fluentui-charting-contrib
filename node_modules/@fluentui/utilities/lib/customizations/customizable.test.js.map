{"version":3,"file":"customizable.test.js","sourceRoot":"../src/","sources":["customizations/customizable.test.tsx"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable deprecation/deprecation */\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom/server';\nimport { mount } from 'enzyme';\nimport { customizable } from './customizable';\nimport { Customizations } from './Customizations';\nimport { Customizer } from './Customizer';\nimport type { IStyle } from '@fluentui/merge-styles';\n\n@customizable('Foo', ['field'])\nclass Foo extends React.Component<{ field?: string }, {}> {\n  public render(): JSX.Element {\n    return <div>{this.props.field}</div>;\n  }\n}\n\ninterface IComponentStyles {\n  root: IStyle;\n}\n\ninterface IComponentProps {\n  styles: IComponentStyles;\n}\n\n@customizable('ConcatStyles', ['styles'], true)\nclass ConcatStyles extends React.Component<IComponentProps, {}> {\n  public render(): JSX.Element {\n    return <div />;\n  }\n}\n\n@customizable('OverrideStyles', ['styles'])\nclass OverrideStyles extends React.Component<IComponentProps, {}> {\n  public render(): JSX.Element {\n    return <div />;\n  }\n}\n\ndescribe('customizable', () => {\n  beforeEach(() => {\n    Customizations.reset();\n  });\n\n  it('can receive global customizations', () => {\n    Customizations.applySettings({ field: 'globalName' });\n    expect(ReactDOM.renderToStaticMarkup(<Foo />)).toEqual('<div>globalName</div>');\n  });\n\n  it('can receive scoped customizations', () => {\n    Customizations.applySettings({ field: 'globalName' });\n    Customizations.applyScopedSettings('Foo', { field: 'scopedName' });\n    expect(ReactDOM.renderToStaticMarkup(<Foo />)).toEqual('<div>scopedName</div>');\n  });\n\n  it('can ignore scoped customizations that do not apply', () => {\n    Customizations.applySettings({ field: 'globalName' });\n    Customizations.applyScopedSettings('Bar', { field: 'scopedName' });\n    expect(ReactDOM.renderToStaticMarkup(<Foo />)).toEqual('<div>globalName</div>');\n  });\n\n  it('can accept props over global/scoped values', () => {\n    Customizations.applySettings({ field: 'globalName' });\n    Customizations.applyScopedSettings('Foo', { field: 'scopedName' });\n    expect(ReactDOM.renderToStaticMarkup(<Foo field=\"name\" />)).toEqual('<div>name</div>');\n  });\n\n  it('can concatenate global styles and component styles', () => {\n    const globalStyles = { color: 'red', background: 'red' };\n    const componentStyles = { color: 'blue' };\n\n    Customizations.applySettings({ styles: { root: globalStyles } });\n    const wrapper = mount(\n      <Customizer>\n        <ConcatStyles styles={{ root: componentStyles }} />\n      </Customizer>,\n    );\n    const component = wrapper.find('ConcatStyles');\n    expect((component.props() as IComponentProps).styles).toEqual({ root: [globalStyles, componentStyles] });\n  });\n\n  it('can concatenate scoped styles and component styles', () => {\n    const scopedStyles = { color: 'green', background: 'green' };\n    const componentStyles = { color: 'blue' };\n\n    Customizations.applyScopedSettings('ConcatStyles', { styles: { root: scopedStyles } });\n    const wrapper = mount(\n      <Customizer>\n        <ConcatStyles styles={{ root: componentStyles }} />\n      </Customizer>,\n    );\n    const component = wrapper.find('ConcatStyles');\n\n    expect((component.props() as IComponentProps).styles).toEqual({ root: [scopedStyles, componentStyles] });\n  });\n\n  it('can override global styles with component styles', () => {\n    const globalStyles = { color: 'red', background: 'red' };\n    const componentStyles = { color: 'blue' };\n\n    Customizations.applySettings({ styles: { root: globalStyles } });\n    const wrapper = mount(\n      <Customizer>\n        <OverrideStyles styles={{ root: componentStyles }} />\n      </Customizer>,\n    );\n    const component = wrapper.find('OverrideStyles');\n\n    expect((component.props() as IComponentProps).styles).toEqual({ root: componentStyles });\n  });\n\n  it('can override scoped styles with component styles', () => {\n    const scopedStyles = { color: 'green', background: 'green' };\n    const componentStyles = { color: 'blue' };\n\n    Customizations.applyScopedSettings('OverrideStyles', { styles: { root: scopedStyles } });\n    const wrapper = mount(\n      <Customizer>\n        <OverrideStyles styles={{ root: componentStyles }} />\n      </Customizer>,\n    );\n    const component = wrapper.find('OverrideStyles');\n\n    expect((component.props() as IComponentProps).styles).toEqual({ root: componentStyles });\n  });\n\n  it('should not mutate styles if no change to component and global styles', () => {\n    const globalRootStyles = { color: 'red', background: 'red' };\n    const componentRootStyles = { color: 'blue' };\n    const componentStyles = { root: componentRootStyles };\n\n    Customizations.applySettings({ styles: { root: globalRootStyles } });\n    const wrapper = mount(\n      <Customizer>\n        <ConcatStyles styles={componentStyles} />\n      </Customizer>,\n    );\n    const component = wrapper.find('ConcatStyles');\n    const finalStyles = (component.props() as IComponentProps).styles;\n    expect(finalStyles).toEqual({ root: [globalRootStyles, componentRootStyles] });\n\n    wrapper.setProps({});\n\n    const updatedComponent = wrapper.find('ConcatStyles');\n    const finalStylesAfterRerender = (updatedComponent.props() as IComponentProps).styles;\n    expect(finalStylesAfterRerender).toBe(finalStyles);\n    expect(finalStylesAfterRerender).toEqual(finalStyles);\n  });\n\n  it('should not mutate styles if no change to component styles without global styles', () => {\n    const componentStyles = { root: { color: 'blue' } };\n\n    const wrapper = mount(\n      <Customizer>\n        <ConcatStyles styles={componentStyles} />\n      </Customizer>,\n    );\n    const component = wrapper.find('ConcatStyles');\n    const finalStyles = (component.props() as IComponentProps).styles;\n    expect(finalStyles).toEqual(componentStyles);\n\n    wrapper.setProps({});\n\n    const updatedComponent = wrapper.find('ConcatStyles');\n    const finalStylesAfterRerender = (updatedComponent.props() as IComponentProps).styles;\n    expect(finalStylesAfterRerender).toBe(finalStyles);\n    expect(finalStylesAfterRerender).toEqual(finalStyles);\n  });\n\n  it('should update styles if component styles changed', () => {\n    const globalRootStyles = { color: 'red', background: 'red' };\n    const componentRootStyles = { color: 'blue' };\n    const componentStyles = { root: componentRootStyles };\n\n    Customizations.applySettings({ styles: { root: globalRootStyles } });\n    const wrapper = mount(\n      <Customizer>\n        <ConcatStyles styles={componentStyles} />\n      </Customizer>,\n    );\n    const component = wrapper.find('ConcatStyles');\n    const finalStyles = (component.props() as IComponentProps).styles;\n    expect(finalStyles).toEqual({ root: [globalRootStyles, componentRootStyles] });\n\n    const newComponentRootStyles = { color: 'red' };\n    const newComponentStyles = { root: newComponentRootStyles };\n\n    // re-render ConcatStyles with new styles\n    wrapper.setProps({\n      children: React.cloneElement(wrapper.props().children, { styles: newComponentStyles }),\n    });\n\n    const updatedComponent = wrapper.find('ConcatStyles');\n    const finalStylesAfterRerender = (updatedComponent.props() as IComponentProps).styles;\n    expect(finalStylesAfterRerender).toEqual({ root: [globalRootStyles, newComponentRootStyles] });\n  });\n});\n"]}